---
title: "Simulation - Test Analysis"
date: Last compiled on `r format(Sys.time(), '%B-%d-%Y')`
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
rm(list = ls())
```

# Load libraries

```{r}
# install.packages(pacman)
library(pacman)

p_load(tidyverse,
       readxl,
       lme4,
       nlme,
       lmerTest,
       psych,
       sjPlot) #Add additional packages



```

# Load data

```{r, echo = TRUE, results = "hide"}
setwd("simulations/") # Change WD for loading files
temp <- list.files(pattern = "\\.RData") # Load all .RData files in folder 

lapply(temp, load, .GlobalEnv)

```

# Confirmatory Analyses

```{r}

#---- Model list for Confirmatory Analyses ----
model_list.C <- list()

```

# Model type 1) Mixed Models

## H1a & H1b) Smartness

```{r}

# ---- Smartness comparison 7.8 & 7.5 ---- 
model_list.C[["H1a_Model.1"]] <- nlme::lme(
  fixed = Y ~ Condition * Contrast,
  random = ~ 1 | Subject,
  data = df_S_1,
  method = "ML"
)

H1a_Model.1 <- lmerTest::lmer(
  Y ~ Condition * Contrast + (1 | Subject),
  data = df_S_1,
  REML = FALSE
)

# ---- Smartness comparison 6.6 & 6.3 ----
model_list.C[["H1a_Model.2"]] <- nlme::lme(
  fixed = Y ~ Condition * Contrast,
  random = ~ 1 | Subject,
  data = df_S_2,
  method = "ML"
)

# ---- Smartness comparison 7.5 & 6.6 ----
model_list.C[["H1b_Model.1"]] <- nlme::lme(
  fixed = Y ~ Condition * Contrast,
  random = ~ 1 | Subject,
  data = df_S_3,
  method = "ML"
)

```

### Checks for significance calculation
```{r}

tab_model(model_list.C[str_detect(names(model_list.C), "H1")],
          dv.labels = names(model_list.C[str_detect(names(model_list.C), "H1")]))

summary(model_list.C[["H1a_Model.1"]])
summary(H1a_Model.1)


drop1(H1a_Model.1, test = "Chisq")
```

## Interaction - Visualization & Decomposition

### H1a - Model 1

```{r}

H1a_Model.1 <- emmeans::emmeans(model_list.C[["H1a_Model.1"]], ~ Condition * Contrast)
# summary(H1a_Model.1)

emmeans::emmeans(H1a_Model.1, pairwise ~ Contrast | Condition, adjust = "none")

emmeans::emmeans(H1a_Model.1, pairwise ~ Condition | Contrast, adjust = "none")

emmeans::contrast(H1a_Model.1,interaction = c("pairwise", "pairwise"),
         adjust = "none")


# emmeans::contrast(H1a_Model.1, "pairwise",by="Condition",adjust="none")
# emmeans::contrast(H1a_Model.1, "pairwise",by="Contrast",adjust="none")

```

```{r}

# Predicted values (population level)
df_S_1$Pred <- predict(model_list.C[["H1a_Model.1"]], level = 0)

P1 <- df_S_1 %>% 
  mutate(Condition = if_else(Condition == 1, "Grouping", "No Grouping"),
         Contrast = if_else(Contrast == 1, "Student-score: 7.5", "Student-score: 7.2")) %>% 
  ggplot(aes(x = factor(Condition, level = c("No Grouping", "Grouping")) , 
             y = Pred,
             color = factor(Contrast, level = c("Student-score: 7.5", "Student-score: 7.2")), 
             group = factor(Contrast, level = c("Student-score: 7.5", "Student-score: 7.2")))) +
  stat_summary(fun = mean, geom = "line", linewidth = .5) +
  stat_summary(fun = mean, geom = "point", size = 2) +
  labs(title = "Interaction Plot (H1a_Model.1): Contrast x Condition",
       y = "Predicted Y",
       x = "Condition",
       color = "Item Contrast") +
  theme_classic()

P1 + scale_color_manual(values=c("#56B4E9", 
                                 "orange"))

```
### H1a - Model 2

```{r}

H1a_Model.2 <- emmeans::emmeans(model_list.C[["H1a_Model.2"]], ~ Condition * Contrast)
# summary(H1a_Model.1)

emmeans::emmeans(H1a_Model.2, pairwise ~ Contrast | Condition, adjust = "none")

emmeans::emmeans(H1a_Model.2, pairwise ~ Condition | Contrast, adjust = "none")

emmeans::contrast(H1a_Model.2,interaction = c("pairwise", "pairwise"),
         adjust = "none")


# emmeans::contrast(H1a_Model.2, "pairwise",by="Condition",adjust="none")
# emmeans::contrast(H1a_Model.2, "pairwise",by="Contrast",adjust="none")

```

```{r}

# Predicted values (population level)
df_S_2$Pred <- predict(model_list.C[["H1a_Model.2"]], level = 0)

P2 <- df_S_2 %>% 
  mutate(Condition = if_else(Condition == 1, "Grouping", "No Grouping"),
         Contrast = if_else(Contrast == 1, "Student-score: 6.6", "Student-score: 6.3")) %>% 
  ggplot(aes(x = factor(Condition, level = c("No Grouping", "Grouping")) , 
             y = Pred,
             color = factor(Contrast, level = c("Student-score: 6.6", "Student-score: 6.3")), 
             group = factor(Contrast, level = c("Student-score: 6.6", "Student-score: 6.3")))) +
  stat_summary(fun = mean, geom = "line", linewidth = .5) +
  stat_summary(fun = mean, geom = "point", size = 2) +
  labs(title = "Interaction Plot (H1a_Model.2): Contrast x Condition",
       y = "Predicted Y",
       x = "Condition",
       color = "Item Contrast") +
  theme_classic()

P2 + scale_color_manual(values=c("red", 
                                 "blue"))

```

### H1b - Model 1

```{r}


H1b_Model.1 <- emmeans::emmeans(model_list.C[["H1b_Model.1"]], ~ Condition * Contrast)
# summary(H1b_Model.1)

emmeans::emmeans(H1b_Model.1, pairwise ~ Contrast | Condition, adjust = "none")

emmeans::emmeans(H1b_Model.1, pairwise ~ Condition | Contrast, adjust = "none")

emmeans::contrast(H1b_Model.1,interaction = c("pairwise", "pairwise"),
         adjust = "none")

# emmeans::contrast(H1b_Model.1, "pairwise",by="Condition",adjust="none")
# emmeans::contrast(H1b_Model.1, "pairwise",by="Contrast",adjust="none")

```

```{r}

# Predicted values (population level)
df_S_3$Pred <- predict(model_list.C[["H1b_Model.1"]], level = 0)

P3 <- df_S_3 %>% 
  mutate(Condition = if_else(Condition == 1, "Grouping", "No Grouping"),
         Contrast = if_else(Contrast == 1, "Student-score: 7.5", "Student-score: 6.6")) %>% 
  ggplot(aes(x = factor(Condition, level = c("No Grouping", "Grouping")) , 
             y = Pred,
             color = factor(Contrast, level = c("Student-score: 7.5", "Student-score: 6.6")), 
             group = factor(Contrast, level = c("Student-score: 7.5", "Student-score: 6.6")))) +
  stat_summary(fun = mean, geom = "line", linewidth = .5) +
  stat_summary(fun = mean, geom = "point", size = 2) +
  labs(title = "Interaction Plot (H1b_Model.1): Contrast Ã— Condition",
       y = "Predicted Y",
       x = "Condition",
       color = "Item Contrast") +
  theme_classic()

P3 + scale_color_manual(values=c("#56B4E9",
                                 "red"))

```

```{r, echo=FALSE}

df_S_1 <- df_S_1 %>% 
  mutate(GD1 = if_else(Condition == 1, 1,0),
         GD2 = if_else(Condition == -1, 1,0),
         CD3 = if_else(Contrast == 1, 1,0),
         CD4 = if_else(Contrast == -1, 1,0))



# tab_model(nlme::lme(
#   fixed = Y ~ GD1 * CD3,
#   random = ~ 1 | Subject,
#   data = df_S_1,
#   method = "ML"
# ))
# 
# tab_model(nlme::lme(
#   fixed = Y ~ GD2 * CD3,
#   random = ~ 1 | Subject,
#   data = df_S_1,
#   method = "ML"
# ))
# 
# tab_model(nlme::lme(
#   fixed = Y ~ GD1 * CD4,
#   random = ~ 1 | Subject,
#   data = df_S_1,
#   method = "ML"
# ))
# 
# tab_model(nlme::lme(
#   fixed = Y ~ GD2 * CD4,
#   random = ~ 1 | Subject,
#   data = df_S_1,
#   method = "ML"
# ))
# 
# 
# tab_model(nlme::lme(
#   fixed = Y ~ GD1 * CD3,
#   random = ~ 1 | Subject,
#   data = df_S_1,
#   method = "ML"
# ))
# 
# tab_model(nlme::lme(
#   fixed = Y ~ GD1 * CD4,
#   random = ~ 1 | Subject,
#   data = df_S_1,
#   method = "ML"
# ))
# 
# tab_model(nlme::lme(
#   fixed = Y ~ GD2 * CD3,
#   random = ~ 1 | Subject,
#   data = df_S_1,
#   method = "ML"
# ))
# 
# tab_model(nlme::lme(
#   fixed = Y ~ GD2 * CD4,
#   random = ~ 1 | Subject,
#   data = df_S_1,
#   method = "ML"
# ))

```

<br>

## H2a) Perceived Similarity

```{r}

# ---- Similarity ----
model_list.C[["H2a_Model.1"]] <- nlme::lme(
  fixed = Y ~ Condition,
  random = ~ 1 | Subject,
  data = df_PS_1,
  method = "ML"
)

```

<br>

## H2a) Perceived Commonality

```{r}

# ---- Commonality ----
model_list.C[["H2b_Model.1"]] <- nlme::lme(
  fixed = Y ~ Condition,
  random = ~ 1 | Subject,
  data = df_PS_2,
  method = "ML"
)

```

<br>

## H2c) Perceived Closeness

```{r}

# ---- Closeness ----
model_list.C[["H2c_Model.1"]] <- nlme::lme(
  fixed = Y ~ Condition,
  random = ~ 1 | Subject,
  data = df_C,
  method = "ML"
)

```

### Results

```{r}

tab_model(model_list.C[str_detect(names(model_list.C), "H2")],
          dv.labels = names(model_list.C[str_detect(names(model_list.C), "H2")]))

```

<br>

# Model type 2) Linear Models

## Hypothesis 3

### Attributions

```{r}
# ---- Internal - Smart ----
model_list.C[["H3a_Model.1"]] <- lm(Attributions_HP_1 ~ Condition, data = df_sim)

# ---- External - Luck ----
model_list.C[["H3b_Model.1"]] <- lm(Attributions_HP_3 ~ Condition, data = df_sim)

```

<br>

### Stability

```{r}
# ---- Smart parents ----
model_list.C[["H3c_Model.1"]] <- lm(Stability_HP_1 ~ Condition, data = df_sim)

# ---- Early emergence ----
model_list.C[["H3d_Model.1"]] <- lm(Stability_HP_2 ~ Condition, data = df_sim)

# ---- Smart future job ----
model_list.C[["H3e_Model.1"]] <- lm(Stability_HP_3 ~ Condition, data = df_sim)

```

### Results

```{r}

tab_model(model_list.C[str_detect(names(model_list.C), "H3")],
          dv.labels = names(model_list.C[str_detect(names(model_list.C), "H3")]))

```

<br>

## Hypothesis 4

### Attributions

```{r}
# ---- Internal - Smart ----
model_list.C[["H4a_Model.1"]] <- lm(Attributions_LP_1 ~ Condition, data = df_sim)

# ---- External - Luck ----
model_list.C[["H4b_Model.1"]] <- lm(Attributions_LP_3 ~ Condition, data = df_sim)

```

<br>

### Stability 

```{r}
# ---- Smart parents ----
model_list.C[["H4c_Model.1"]] <- lm(Stability_LP_1.R ~ Condition, data = df_sim)

# ---- Early emergence ----
model_list.C[["H4d_Model.1"]] <- lm(Stability_LP_2.R ~ Condition, data = df_sim)

# ---- Smart future job ----
model_list.C[["H4e_Model.1"]] <- lm(Stability_LP_3.R ~ Condition, data = df_sim)

```

### Results

```{r}

tab_model(model_list.C[str_detect(names(model_list.C), "H4")],
          dv.labels = names(model_list.C[str_detect(names(model_list.C), "H4")]))

```

<br>

# Exploratory Analyses

In this stage, only the following exploratory analyses are worked out:

-   Exploratory Smartness hypothesis

-   Exploratory Dependent variables (Hard work - attribution & Future financial success)

-   Exploratory random effects

The following exploratory analyses will be worked out as part of the paper:

-   Exploratory Moderation analyses

-   Confirmatory Factor Analysis

```{r, include=FALSE}
#---- Model list for Exploratory Analyses
model_list.E <- list()

```

## Exploratory Smartness hypothesis

```{r, include=FALSE}
# ---- Smartness comparison 7.5 & 6.6 ----
model_list.E[["EH_Model.1"]] <- nlme::lme(
  fixed = Y ~ Condition * Contrast,
  random = ~ 1 + Contrast | Subject,
  data = df_S_3,
  method = "ML"
)

```

#### Results

```{r, include=FALSE}

tab_model(model_list.E[str_detect(names(model_list.E), "EH")],
          dv.labels = names(model_list.E[str_detect(names(model_list.E), "EH")]))

```

<br>

## Exploratory Dependent Variables

```{r, include=FALSE}
# ---- Stability - Future Financial Success ----
model_list.E[["EDV1_HP_Model.1"]] <- lm(Stability_HP_4 ~ Condition, data = df_sim)
model_list.E[["EDV1_LP_Model.1"]] <- lm(Stability_LP_4.R ~ Condition, data = df_sim)

# ---- External - Hard Work ----
model_list.E[["EDV2_HP_Model.1"]] <- lm(Attributions_HP_2 ~ Condition, data = df_sim)
model_list.E[["EDV2_LP_Model.1"]] <- lm(Attributions_LP_2 ~ Condition, data = df_sim)

```

#### Results

```{r, include=FALSE}

tab_model(model_list.E[str_detect(names(model_list.E), "EDV")],
          dv.labels = names(model_list.E[str_detect(names(model_list.E), "EDV")]))

```

<br>

## Exploratory Random Effects

### Perceived Similarity

```{r, include=FALSE}

# ---- Similarity ----
model_list.E[["H2a_Model.1"]] <- nlme::lme(
  fixed = Y ~ Condition * Contrast,
  random = ~ 1 + Contrast | Subject,
  data = df_PS_1,
  method = "ML"
)

# ---- Commonality ----
model_list.E[["H2b_Model.1"]] <- nlme::lme(
  fixed = Y ~ Condition * Contrast,
  random = ~ 1 + Contrast | Subject,
  data = df_PS_2,
  method = "ML"
)

```

### Closeness

```{r, include=FALSE}

model_list.E[["H3_Model.1"]] <- nlme::lme(
  fixed = Y ~ Condition * Contrast,
  random = ~ 1 + Contrast | Subject,
  data = df_C,
  method = "ML"
)

```

### TO BE EXPANDED???

```{r, include=FALSE}

# model_list.E[["H4a_Model.1"]] <- nlme::lme(
#   fixed = Y ~ Condition * Contrast,
#   random = ~ 1 + Contrast | Subject,
#   data = df_A_1,
#   method = "ML"
# )

```
